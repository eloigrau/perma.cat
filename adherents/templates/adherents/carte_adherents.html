{% extends 'base_adherents.html' %}
{% load carto_filters %}
{% load app_filters %}
{% load widget_tweaks %}
{% block headerDocument%}
{% load leaflet_tags %}
{% endblock %}
{% block header %}
{% load static %}
{% load staticfiles %}
{% leaflet_js %}
{% leaflet_css %}
{%endblock%}
{% block title %} - Carte - Adhérents Conf
{% endblock %}

{%block bodyEntete%} style="visibility: collapse;" {%endblock%}
{% block subtitle %}
<div class="row textcenter">
  <div class="col-sm-12 textcenter">
    <h4> {{titre}}</h4>
  </div>
</div>

<div class="row textcenter">
  <div class="col-sm-12 textcenter">
        {%if request.user.is_superuser %}
        <a href="{% url 'adherents:adherent_ajouter'%}">
            <button type="button" class="btn btn-sm btn-danger">
                <span class="glyphicon glyphicon-plus"></span>&nbsp;Ajouter un adhérent
            </button>
        </a>
        {%endif%}
        {%if request.user.is_superuser %}
        <a href="https://www.perma.cat/gestion/adherents/adherent/">
            <button type="button" class="btn btn-sm btn-danger">
                <span class="glyphicon glyphicon-plus"></span>&nbsp;SU Admin
            </button>
        </a>
        {%endif%}
</div></div>
{% endblock %}
{% block content %}



<div class="row cartePleinePage" >
  <div class="col-md-12" >
    <style>.leaflet-container {width:  100%;min-height: 80vh;}</style>
      <script type="text/javascript">

        function map_init_basic (map, options) {
          var leafIcon = L.icon({
            iconUrl: '{% static 'img/leafgreen.png' %}',
            shadowUrl: '{% static 'img/leafshadow.png' %}',

            iconSize:     [38, 95], // size of the icon
            shadowSize:   [50, 64], // size of the shadow
            iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
            shadowAnchor: [4, 62],  // the same for the shadow
            popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
        });

          var greenIcon = L.icon({
              iconUrl: '{% static 'img/marker-icon-green.png' %}',
              shadowUrl: '{% static 'img/marker-shadow.png' %}',
              iconSize: [25, 41],
              iconAnchor: [12, 41],
              popupAnchor: [1, -34],
              shadowSize: [41, 41]
        });
          var blueIcon = L.icon({
              iconUrl: '{% static 'img/marker-icon-blue.png' %}',
              shadowUrl: '{% static 'img/marker-shadow.png' %}',
              iconSize: [25, 41],
              iconAnchor: [12, 41],
              popupAnchor: [1, -34],
              shadowSize: [41, 41]
        });
          var blackIcon = L.icon({
              iconUrl: '{% static 'img/marker-icon-black.png' %}',
              shadowUrl: '{% static 'img/marker-shadow.png' %}',
              iconSize: [25, 41],
              iconAnchor: [12, 41],
              popupAnchor: [1, -34],
              shadowSize: [41, 41]
        });
          var greyIcon = L.icon({
              iconUrl: '{% static 'img/marker-icon-black.png' %}',
              shadowUrl: '{% static 'img/marker-shadow.png' %}',
              iconSize: [25, 41],
              iconAnchor: [12, 41],
              popupAnchor: [1, -34],
              shadowSize: [41, 41]
        });
          var yellowIcon = L.icon({
              iconUrl: '{% static 'img/marker-icon-yellow.png' %}',
              shadowUrl: '{% static 'img/marker-shadow.png' %}',
              iconSize: [25, 41],
              iconAnchor: [12, 41],
              popupAnchor: [1, -34],
              shadowSize: [41, 41]
        });
          var orangeIcon = L.icon({
              iconUrl: '{% static 'img/marker-icon-orange.png' %}',
              shadowUrl: '{% static 'img/marker-shadow.png' %}',
              iconSize: [25, 41],
              iconAnchor: [12, 41],
              popupAnchor: [1, -34],
              shadowSize: [41, 41]
        });

        {% for profil in adherents %}
            var lat = {{profil.adresse.get_latitude}};
            var lon = {{profil.adresse.get_longitude}};
            {% if profil.statut == '1' %}
            var marker = L.marker([lat, lon], {icon: greenIcon}).bindPopup('<a href="{% url 'adherents:adherent_detail' profil.pk %}"> {{profil.nom}} {{profil.prenom}}</a>');
            {% elif profil.statut == '2' or profil.statut == 'CotSol'%}
            var marker = L.marker([lat, lon], {icon: blueIcon}).bindPopup('<a href="{% url 'adherents:adherent_detail' profil.pk %}"> {{profil.nom}} {{profil.prenom}}</a>');
            {% elif profil.statut == '3' %}
            var marker = L.marker([lat, lon], {icon: greyIcon}).bindPopup('<a href="{% url 'adherents:adherent_detail' profil.pk %}"> {{profil.nom}} {{profil.prenom}}</a>');
            {% elif profil.statut == '5' %}
            var marker = L.marker([lat, lon], {icon: yellowIcon}).bindPopup('<a href="{% url 'adherents:adherent_detail' profil.pk %}"> {{profil.nom}} {{profil.prenom}}</a>');
            {% elif profil.statut == '4' %}
            var marker = L.marker([lat, lon], {icon: orangeIcon}).bindPopup('<a href="{% url 'adherents:adherent_detail' profil.pk %}"> {{profil.nom}} {{profil.prenom}}</a>');
            {% else %}
            var marker = L.marker([lat, lon], {icon: blackIcon}).bindPopup('<a href="{% url 'adherents:adherent_detail' profil.pk %}"> {{profil.nom}} {{profil.prenom}}</a>');

            {% endif %}
            marker.addTo(map);
        {%endfor%}

        {% if filter.qs|length == 1 %}
        map.panTo(new L.LatLng(lat, lon));
        {%else%}
        map.panTo(new L.LatLng(42.62914, 2.49939));
        {%endif%}
    }
</script>
{% leaflet_map "yourmap" callback="window.map_init_basic" %}
</div>
</div>
      <p class="textepetit textcenter">Bleu : Cotisant Solidaire; Vert : à titre principal; Jaune : à titre secondaire; Orange : retraité.e; Gris : CC; Noir : ?</p>

<hr>
<div class="row">
    <div class="col-sm-12 textcenter">
<button type="button" class="btn btn-info" data-toggle="modal" data-target="#help" title="Filtrer">
Filtrer / rechercher...
</button>
<!-- Modal -->
<div class="modal fade" id="help" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog textaide" role="document">
    <div class="modal-content">
      <div class="modal-header">
          <div class="row justify-content-center">
           <h5 > Filtrer/rechercher les profils</h5>
              {% if asso.abreviation != "public" %}
              <p>Parmi les membres du groupe {{ asso.nom }}</p>
              {% else %}
              <p>Parmi tous les inscrits sur le site</p>
              {% endif %}
          </div>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body textleft">
<form method="get">
    <div class="well">
      <div class="row">
        <div class="form-group col-sm-12">
            <label>Rechercher :</label>
          {% render_field filter.form.compet_descrip class="form-control" %}
        </div>
          <br>
          <div class="form-group col-sm-12">
              <div>
          {{ filter.form.statut.label_tag }}
            <label class="checkbox-inline">{% render_field filter.form.statut %}</label>
              </div>
              <div>
          {{ filter.form.annee.label_tag }}
            <label class="checkbox-inline">{% render_field filter.form.annee %}</label>
              </div>
            </div>
      </div>

    <div class="row">
    <div class="col-md-12 textcenter">
      <button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span> Filtrer les profils
      </button>
    </div>
    </div>
</div>
  </form>
      </div>
    </div>
  </div>
</div>
</div>
</div>

{% include "adherents/template_annuaire_adherents.html" with profils=filter.qs %}

{% endblock %}

    
