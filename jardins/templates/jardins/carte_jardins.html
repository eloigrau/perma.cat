{% extends 'base_plantes.html' %}
{% load carto_filters %}
{% load app_filters %}
{% load widget_tweaks %}
{% block headerDocument%}
{% load leaflet_tags %}
{% endblock %}
{% block header %}
{% load static %}
{% load staticfiles %}
{% leaflet_js %}
{% leaflet_css %}
<link href="{% static 'css/leaflet-locationpicker.css'%}" rel="stylesheet" />
<script src="{% static 'js/leaflet-locationpicker.js' %}"></script>
{%endblock%}
{% block title %} - Carte des jardins du 66
{% endblock %}

{%block bodyEntete%} style="visibility: collapse;" {%endblock%}
{% block subtitle %}
<div class="row textcenter">
  <div class="col-sm-12 textcenter">
    <h4> {{titre}} </h4>
  </div>
</div>

<div class="row textcenter">
  <div class="col-sm-12 textcenter">
<a href="{% url 'jardins:jardin_ajouter' %}">
    <button type="button" class="btn  btn-success" >
        <i class="fa fa-plus"></i>&nbsp; Ajouter un jardin
    </button>
</a>
  </div>
  </div>

{% endblock %}
{% block content %}

<hr>
<div class="row cartePleinePage justify-content-center">
  <div class="col-md-12" >
      <script type="text/javascript">

        function map_init_basic (map, options) {
          var leafIcon = L.icon({
            iconUrl: '{% static 'img/leafgreen.png' %}',
            shadowUrl: '{% static 'img/leafshadow.png' %}',

            iconSize:     [38, 95], // size of the icon
            shadowSize:   [50, 64], // size of the shadow
            iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
            shadowAnchor: [4, 62],  // the same for the shadow
            popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
        });
{% comment %}
          var greyIcon = L.icon({
              iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-grey.png',
              shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
              iconSize: [25, 41],
              iconAnchor: [12, 41],
              popupAnchor: [1, -34],
              shadowSize: [41, 41]
        });
{% endcomment %}
          var greenIcon = L.icon({
              iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
              shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
              iconSize: [25, 41],
              iconAnchor: [12, 41],
              popupAnchor: [1, -34],
              shadowSize: [41, 41]
        });

        {% for jardin in filter.qs %}
            {% if jardin.adresse.get_latitude %}
                var lat = {{ jardin.adresse.get_latitude }};
                var lon = {{ jardin.adresse.get_longitude }};
                var marker = L.marker([lat, lon], {icon: leafIcon}).bindPopup('<a href="{% url 'jardins:jardin_lire' jardin.slug%}"> {{jardin.titre}} </a>');
                marker.addTo(map);
            {% endif %}
        {%endfor%}

        {% if filter.qs|length == 1 %}
        map.panTo(new L.LatLng(lat, lon));
        {%else%}
        map.panTo(new L.LatLng(42.62914, 2.49939));
        {%endif%}

        map.on('click', function(ev) {
            var leafIcon = L.icon({
            iconUrl: '{% static 'img/leafgreen.png' %}',
            shadowUrl: '{% static 'img/leafshadow.png' %}',

            iconSize:     [38, 95], // size of the icon
            shadowSize:   [50, 64], // size of the shadow
            iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
            shadowAnchor: [4, 62],  // the same for the shadow
            popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
        });
            $('#lat').val(ev.latlng.lat);
          $('#lng').val(ev.latlng.lng);
          if (typeof pin == "object") {
            pin.setLatLng(ev.latlng);
          } else {
            pin = L.marker(ev.latlng,{ riseOnHover:true,draggable:true,icon: leafIcon });
            pin.addTo(map);
            pin.on('drag',function(ev) {
              $('#lat').val(ev.latlng.lat);
              $('#lng').val(ev.latlng.lng);
            });
          }
        });
}
$('.example').leafletLocationPicker({
  alwaysOpen: false,
  {% comment %}
  className: baseClassName,
  {% endcomment %}
  location: yourmap.center,
  locationFormat: '{lat}{sep}{lng}',
  locationMarker: true,
  locationDigits: 6,
  locationSep: ',',
  position: 'topright',
  layer: 'OSM',
  height: 140,
  width: 200,
  event: 'click',
  cursorSize: '30px',
  map: yourmap,
  onChangeLocation: $.noop,
  mapContainer: "#yourmap"
});
</script>


{% leaflet_map "yourmap" callback="window.map_init_basic" %}
</div>
</div>

<hr>
<div class="row">
    <div class="col-sm-12 textcenter">
<button type="button" class="btn btn-info" data-toggle="modal" data-target="#help" title="Filtrer">
Filtrer / rechercher...
</button>
<!-- Modal -->
<div class="modal fade" id="help" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog textaide" role="document">
    <div class="modal-content">
      <div class="modal-header">
          <div class="row justify-content-center">
           <h5 > Filtrer/rechercher </h5>
          </div>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body textleft">
<form method="get">
    <div class="well">
      <div class="row">
        <div class="form-group col-sm-12">
            <label>Rechercher :</label>
          {% render_field filter.form.compet_descrip class="form-control" %}
          {% render_field filter.form.categorie class="form-control" %}
        </div>
          <br>
      </div>

    <div class="row">
    <div class="col-md-12 textcenter">
      <button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span> Rechercher...
      </button>
    </div>
    </div>
</div>
  </form>
      </div>
    </div>
  </div>
</div>
</div>
</div>
<hr>
{% include "template_annuaire_jardin.html" with jardins=filter.qs %}

{% endblock %}

    
